<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cubic Bezier Curve Editor</title>
  <script src="https://unpkg.com/three@0.136.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.136.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.136.0/examples/js/controls/DragControls.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.1/dat.gui.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
let camera, scene, renderer, controls, dragControls;
let curveGeometry;
let curve, pointGeometry, pointMaterial, pointMeshes = [];

let pointStartPosition = new THREE.Vector3();

init();

function init() {
  // Create camera
  camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(5, 5, 5);
  camera.lookAt(0, 0, 0);
  camera.rotateOnAxis(new THREE.Vector3(1, 0, 0), -Math.PI / 4);

  // Create scene
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x121212);

  // Create curve
  const curveMaterial = new THREE.LineBasicMaterial({ color: 0xffff44 });
  curve = new THREE.CubicBezierCurve3(
    new THREE.Vector3(-1, -1, 0),
    new THREE.Vector3(-0.5, 1, 0),
    new THREE.Vector3(0.5, -1, 0),
    new THREE.Vector3(1, 1, 0)
  );
  curveGeometry = new THREE.BufferGeometry().setFromPoints(curve.getPoints(50));
  const curveLine = new THREE.Line(curveGeometry, curveMaterial);
  scene.add(curveLine);
  
  const axisHelper = new THREE.AxesHelper(5);
  scene.add(axisHelper);

  const gridHelper = new THREE.GridHelper(10, 10);
  scene.add(gridHelper);

  // Create points
  pointGeometry = new THREE.SphereGeometry(0.1, 32, 32);
  pointMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
  const points = [curve.v0, curve.v1, curve.v2, curve.v3];
  for (let i = 0; i < points.length; i++) {
    const pointMesh = new THREE.Mesh(pointGeometry, pointMaterial);
    pointMesh.position.copy(points[i]);
    scene.add(pointMesh);
    pointMeshes.push(pointMesh);
  }

  // Create renderer
  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Create controls
  controls = new THREE.OrbitControls(camera, renderer.domElement);

  // Create drag controls
  dragControls = new THREE.DragControls(pointMeshes, camera, renderer.domElement);
  dragControls.addEventListener('dragstart', onDragStart);
  dragControls.addEventListener('dragend', onDragEnd);
  dragControls.addEventListener('dragmove', onDragMove);

  // Handle window resize
  window.addEventListener('resize', onWindowResize);
}

function onDragStart(event) {
    controls.enabled = false;
  pointStartPosition.copy(event.object.position);
}

function onDragEnd(event) {
  const curvePoints = [curve.v0, curve.v1, curve.v2, curve.v3];
  const pointIndex = pointMeshes.indexOf(event.object);
  curvePoints[pointIndex].copy(event.object.position);
  curve.needsUpdate = true;
  controls.enabled = true;
  
  curveGeometry.setFromPoints(curve.getPoints(50));
}

function onDragMove(event) {
  const curvePoints = [curve.v0, curve.v1, curve.v2, curve.v3];
  const pointIndex = pointMeshes.indexOf(event.object);
  curvePoints[pointIndex].copy(event.object.position);
  curve.needsUpdate = true;

  curveGeometry.setFromPoints(curve.getPoints(50));
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}

animate();

// UI PART

var gui = new dat.GUI();
var obj = {
  add: function() {
    const curvePoints = [curve.v0, curve.v1, curve.v2, curve.v3];
	const curveValues = curvePoints.flatMap(p => [p.x.toFixed(4), p.y.toFixed(4), p.z.toFixed(4)]).join(" ");
	
	navigator.clipboard.writeText(curveValues).then(() => {
		console.log("Curve values copied to clipboard");
	});
  }
};
gui.add(obj, "add").name("Copy point values");

  </script>
</body>
</html>
